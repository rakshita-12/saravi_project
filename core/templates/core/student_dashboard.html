{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Student Dashboard | CodeQuest AI</title>

  <!-- CSS -->
  <link rel="stylesheet" href="{% static 'dynamic/CSS/student_dashboard.css' %}" />
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&family=Fira+Code&display=swap" rel="stylesheet">
</head>

<body>
  <!-- THEME TOGGLE -->
  <button id="themeToggle" class="theme-toggle" aria-label="Toggle theme">ğŸŒ™</button>

  <!-- HEADER -->
  <header class="header">
    <div class="brand">CodeQuest <span>AI</span></div>
    <div class="header-right"></div>
  </header>

  <main class="container">
    <!-- FACULTY INFO SECTION -->
    <section class="faculty-section panel">
      <div class="faculty-card">
        <h3>ğŸ‘©â€ğŸ« Faculty In-Charge</h3>
        <p id="facultyName">
          {% if faculty %}
            {{ faculty.user.get_full_name|default:faculty.user.username }} ({{ faculty.department }})
          {% else %}
            Not assigned yet
          {% endif %}
        </p>
      </div>
    </section>

    <!-- QUESTIONS GRID -->
    <section class="questions-section panel">
      <h2 class="panel-title">ğŸ“š Available Challenges</h2>
      <div class="questions-grid">
        {% for question in questions %}
          <div class="question-card" data-question-id="{{ question.id }}">
            <div class="question-header">
              <h3>{{ question.title }}</h3>
              <span class="difficulty-badge difficulty-{{ question.difficulty|lower }}">
                {{ question.difficulty }}
              </span>
            </div>
            <p class="question-description">{{ question.description|truncatewords:30 }}</p>
            <div class="question-footer">
              <span class="marks">ğŸ’ {{ question.marks }} marks</span>
              <button class="btn-solve" data-question-id="{{ question.id }}">
                Solve Challenge â†’
              </button>
            </div>
          </div>
        {% empty %}
          <p class="empty-state">No challenges available yet. Check back soon!</p>
        {% endfor %}
      </div>
    </section>

    <!-- LANGUAGE SELECTION -->
    <section id="languageSection" class="language-section panel hidden">
      <h2 class="panel-title">Choose a Programming Language</h2>
      <div id="languageGrid" class="language-grid">
        {% for lang, emoji in languages.items %}
          <button class="lang-card" data-lang="{{ lang }}">
            {{ emoji }} {{ lang }}
          </button>
        {% endfor %}
      </div>
    </section>

    <!-- WORKSPACE -->
    <section id="workspace" class="workspace panel hidden" aria-hidden="true">
      <div class="workspace-header">
        <button id="backToLang" class="ghost">â† Back</button>
        <h3 id="workspaceTitle">Language: â€”</h3>
        <div class="workspace-controls">
          <button id="enterFocus" class="focus-btn">ğŸ¯ Enter Focus Mode</button>
        </div>
      </div>

      <div class="workspace-body">
        <!-- Question Column -->
        <aside class="col question-col">
          <h4>Challenge</h4>
          <div class="card question-card" id="challengeCard">
            <h5 id="challengeTitle">Select a challenge to view details</h5>
            <p id="challengeDesc"></p>
            <div id="questionDetails" style="display:none;">
              <h6>Difficulty: <span id="questionDifficulty"></span></h6>
              <h6>Marks: <span id="questionMarks"></span></h6>
              <h6>Example Input</h6>
              <pre class="example" id="exampleInput"></pre>
              <h6>Example Output</h6>
              <pre class="example" id="exampleOutput"></pre>
              <h6>Constraints</h6>
              <pre class="constraints" id="questionConstraints"></pre>
            </div>
          </div>
        </aside>

        <!-- Editor Column -->
        <section class="col editor-col">
          <div class="editor-top">
            <select id="langSelect" class="lang-select">
              <option>Python</option>
              <option>C++</option>
              <option>Java</option>
              <option>JavaScript</option>
            </select>

            <div class="editor-actions">
              <button id="runBtn" class="btn action">â–¶ Run (Ctrl/Cmd+Enter)</button>
              <button id="submitBtn" class="btn action alt">ğŸ§  Submit</button>
              <button id="saveBtn" class="btn">ğŸ’¾ Save</button>
            </div>
          </div>

          <div class="editor-wrap">
            <textarea id="codeEditor" class="code-editor" spellcheck="false">// Start coding here...</textarea>
          </div>
        </section>

      </div>

      <!-- AI Evaluation Section - Full Width -->
      <section class="ai-evaluation-section">
        <div class="eval-header">
          <h4>ğŸ¤– AI Evaluation & Feedback</h4>
          <div class="eval-stats">
            <span class="stat-item"><strong>Score:</strong> <span id="score">â€”</span></span>
            <span class="stat-item"><strong>Tests:</strong> <span id="tests">â€”</span></span>
            <span class="stat-item"><strong>Logic:</strong> <span id="logic">â€”</span></span>
          </div>
        </div>
        <textarea id="aiFeedback" class="ai-feedback-textarea" readonly placeholder="Run or Submit your code to get AI-powered feedback and analysis..."></textarea>
        <div class="badges" id="badgeList"></div>
      </section>

      <!-- Submissions Table -->
      <section class="submissions panel">
        <h3>ğŸ“Š Your Recent Submissions</h3>
        <table class="styled-table">
          <thead>
            <tr>
              <th>Question</th>
              <th>Language</th>
              <th>Score</th>
              <th>Status</th>
              <th>Submitted At</th>
            </tr>
          </thead>
          <tbody>
            {% for sub in submissions %}
              <tr>
                <td><strong>{{ sub.question.title }}</strong></td>
                <td><span class="lang-badge">{{ sub.language }}</span></td>
                <td>
                  <span class="score-badge {% if sub.score >= 70 %}score-high{% elif sub.score >= 40 %}score-medium{% else %}score-low{% endif %}">
                    {{ sub.score|floatformat:0 }}%
                  </span>
                </td>
                <td>
                  {% if sub.score == 100 %}
                    <span class="status-badge status-passed">âœ“ Passed</span>
                  {% elif sub.score >= 50 %}
                    <span class="status-badge status-partial">~ Partial</span>
                  {% else %}
                    <span class="status-badge status-failed">âœ— Failed</span>
                  {% endif %}
                </td>
                <td>{{ sub.submitted_at|date:"M d, Y H:i" }}</td>
              </tr>
            {% empty %}
              <tr>
                <td colspan="5" class="empty-state">No submissions yet. Start solving challenges!</td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      </section>
    </section>
  </main>

  <!-- Focus Mode Exit -->
  <button id="exitFocusBtn" class="exit-focus hidden" aria-label="Exit Focus Mode">âœ– Exit Focus Mode</button>

  <!-- Focus Warning -->
  <div id="focusWarning" class="focus-warning hidden">
    You left Focus Mode (switching tabs is disabled). Return immediately to continue.
  </div>

  <!-- JS -->
  <script src="{% static 'dynamic/JS/student_dashboard.js' %}" defer></script>
</body>
</html>
